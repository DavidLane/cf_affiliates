<script type="text/javascript">
  $(document).ready(function() {
    
    <% unless @affiliates.blank? %>
      
      <% @affiliates.each do |a| %>
        <% if a.has_geolocation_data? %>          
          markers.push(createMarker(map, <%= a.coords_lat %>, <%= a.coords_long %>, "<%= a.title %>", <%= a.id %>));
          affiliates.push("<%= a.title %>");
        <% end %>
      <% end %>
      
      $('#search-name').typeahead({
        source: affiliates,
        updater: function(item) {
          // alert(item);
          return item;
        }
      });
    <% end %>
    
    $("#search-name").select2({
      placeholder: "Select an affiliate...",
    });
    
    $("#search-name").on("change", function(e){
      var affiliate_id = e.val;
      marker = getMarkerByAffiliateId(affiliate_id);
      selectMarker(marker);
    });
       
  });
  
</script>
<div class="row">
  <div class="span12">
    <h1>UK and Ireland Affiliate Data</h1>
    <p class="lead">A complete, fully searchable list of UK and Ireland affiliates as seen on <a href="http://www.crossfit.com">CrossFit.com</a></p>
  </div>
</div>
<div class="row">
  <div class="span8">
    <div id="map-canvas">&nbsp;</div>    
  </div>
  <div class="span4">
    <div class="row">
      <div class="span4">
        <div class="row">
          <div class="btn-group pull-right" id="search-controls" data-toggle="buttons-radio">
            <button type="button" class="btn btn-large" title="Search" id="search-btn"><span class="icon-search"></span></button>          
            <button type="button" class="btn btn-large" title="List" id="list-btn"><span class="icon-list-alt"></span></button>          
            <button type="button" class="btn btn-large" title="Add" id="add-btn"><span class="icon-plus"></span></button>           
          </div>
        </div>
        <div class="row">        
          <%= render "search_title" %>
          <%= render "search_region" %>
          <%= render "search_postcode" %>
        </div>
      </div>       
    </div>    
    <div class="row">
      <div class="span4">
        <%= render "affiliate_box" %>
      </div>
    </div>    
  </div>
</div>
  


