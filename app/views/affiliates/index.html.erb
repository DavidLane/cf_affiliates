<script type="text/javascript">  
  $(document).ready(function() {
    
    <% unless @affiliates.blank? %>
    var infoWindows = [];
    var markers = [];
      <% @affiliates.each do |a| %>
        <% if a.has_geolocation_data? %>
          var myLatlng<%= a.id %> = new google.maps.LatLng(<%= a.coords_lat %>,<%= a.coords_long %>);    
          var marker<%= a.id %> = new google.maps.Marker({
              position: myLatlng<%= a.id %>,
              map: map,
              title: "<%= a.title %>"
          }); 
          
          markers.push(marker<%= a.id %>);
          
          google.maps.event.addListener(marker<%= a.id %>, 'click', function() {
            $(".affiliate_info").hide();
            $("#affiliate-info-<%= a.id %>").show();
          });
        <% end %>
      <% end %>
    //var markerCluster = new MarkerClusterer(map, markers);      
    <% end %>
       
  });  
</script>

<div class="row">
  <div class="span8">
    <div id="map-canvas">&nbsp;</div>    
  </div>
  <div class="span4">
    <div class="row">
      <div class="span4">
        <div class="alert">
          <button type="button" class="close" data-dismiss="alert">&times;</button>
          Select an affiliate for more details
        </div>
      </div>
    </div>    
    <div class="row">
      <div class="span4">
        <%= render "affiliate_box" %>
      </div>
    </div>    
  </div>
</div>
  


